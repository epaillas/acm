#!/bin/bash -l

#SBATCH --nodes 1
#SBATCH --constraint cpu
#SBATCH --qos regular
#SBATCH --account desi

#SBATCH --time 00:30:00

#SBATCH --job-name prep_small
#SBATCH --output /global/homes/s/sbouchar/ACM_pipeline/prepare_simulations/small_boxes/out_jobs/%A.%x_%a.out
#SBATCH --error /global/homes/s/sbouchar/ACM_pipeline/prepare_simulations/small_boxes/out_jobs/%A.%x_%a.err

# Load the modules of the DESI environment (cosmodesi)
source /global/common/software/desi/users/adematti/cosmodesi_environment.sh main

# Parameters for the script (Can be given when launching the job !)
# List of phases to be used --> 1643 phases
PHASE_LIST=({3000..3005} 3007 3009 {3011..3017} {3019..3023} 3025 {3028..3035} {3039..3047} {3049..3054} {3056..3057} {3061..3070} {3072..3077} {3079..3088} {3090..3094} {3096..3106} {3108..3112} {3114..3125} {3129..3142} {3144..3149} 3151 {3153..3154} {3156..3163} {3166..3167} {3169..3170} {3172..3176} 3178 3180 {3182..3191} {3193..3195} {3197..3209} 3211 3213 {3215..3218} 3220 {3222..3224} 3227 {3229..3235} {3237..3248} {3250..3252} {3254..3268} {3270..3276} {3278..3283} {3286..3293} {3296..3300} {3302..3316} {3318..3320} {3322..3334} {3336..3341} {3345..3348} 3350 {3352..3355} {3358..3370} {3372..3377} 3379 {3381..3386} {3388..3404} {3406..3422} 3424 {3426..3430} {3433..3438} {3440..3442} {3445..3456} {3458..3466} 3468 3470 {3472..3474} {3476..3489} {3491..3504} {3507..3514} 3517 {3519..3522} {3524..3533} 3535 {3537..3538} 3540 {3542..3554} {3556..3559} {3561..3562} {3564..3569} {3571..3573} {3575..3579} {3581..3584} {3587..3590} {3592..3604} {3606..3612} {3614..3619} {3622..3631} {3633..3638} {3640..3649} {3651..3658} {3663..3666} {3668..3683} {3685..3704} 3706 {3708..3713} {3716..3721} {3724..3725} {3727..3732} {3734..3740} {3742..3755} {3757..3768} {3770..3771} 3773 {3776..3779} {3781..3782} {3784..3785} {3787..3792} {3794..3798} 3800 {3803..3808} {3810..3813} {3816..3818} {3820..3823} {3825..3834} {3836..3841} {3843..3847} {3849..3871} {3873..3885} {3887..3891} {3893..3899} {3901..3910} {3912..3918} 3920 {3922..3937} 3939 3941 3943 {3945..3946} 3948 {3950..3953} {3955..3967} {3969..3973} {3975..3978} {3981..3983} 3985 {3987..3996} 3998 4000 {4002..4006} {4008..4015} {4018..4019} {4021..4036} {4038..4042} {4045..4048} {4051..4058} 4060 {4063..4064} {4066..4081} {4083..4091} {4093..4102} {4104..4105} {4107..4110} {4112..4114} {4116..4123} {4125..4133} {4135..4142} 4146 4148 {4150..4157} {4159..4169} {4171..4178} {4181..4194} {4196..4200} {4202..4208} {4210..4217} {4219..4220} {4222..4226} {4228..4231} 4233 {4235..4238} {4240..4241} {4243..4261} {4263..4270} {4272..4280} {4282..4283} {4286..4290} 4292 4294 {4296..4297} {4299..4300} {4302..4304} {4306..4314} {4316..4321} 4324 {4326..4328} {4330..4335} 4337 {4339..4344} 4346 {4348..4355} {4357..4358} 4360 {4362..4374} {4376..4383} {4385..4388} {4390..4396} {4399..4402} {4404..4407} {4409..4410} {4412..4425} {4427..4428} {4430..4447} {4450..4456} {4458..4463} {4465..4467} 4469 {4471..4473} {4476..4477} 4479 4481 {4483..4487} 4489 {4491..4492} {4494..4504} {4506..4511} 4514 4516 {4520..4521} 4523 4525 {4527..4531} {4533..4541} {4543..4546} {4548..4552} 4554 {4556..4567} {4569..4574} {4577..4582} 4584 {4586..4593} 4595 {4597..4604} {4606..4607} 4611 {4613..4617} {4619..4620} {4623..4624} {4626..4627} {4629..4631} {4634..4642} 4644 {4646..4652} {4654..4661} {4663..4674} {4676..4678} 4681 {4683..4686} 4688 {4690..4698} {4700..4702} {4704..4712} {4714..4719} 4721 {4723..4727} {4729..4731} {4733..4734} {4737..4740} {4742..4761} 4763 4765 {4767..4791} {4793..4795} 4797 4799 {4801..4811} {4813..4815} {4817..4822} {4824..4827} {4829..4830} {4832..4836} {4838..4842} 4845 4848 {4850..4856} {4858..4864} 4866 {4869..4875} 4878 {4880..4886} {4890..4892} {4894..4897} {4899..4900} {4902..4906} {4908..4917} {4919..4935} {4937..4943} {4945..4946} {4948..4949} 4951 4953 {4956..4960} 4962 {4964..4965} {4967..4969} 4971 {4973..4975} {4977..4980} 4982 {4985..4999})

PATH2CONFIG='/global/homes/s/sbouchar/ACM_pipeline/prepare_simulations/small_boxes/config_c000_small.yaml'
LOG_PATH='/global/homes/s/sbouchar/ACM_pipeline/prepare_simulations/small_boxes/logs_cosmos_small/'

ID=$((SLURM_ARRAY_TASK_ID)) # ID of the phase to be used, starting from 0
PHASE=${PHASE_LIST[$ID]} # phase to be used
LOG=$(printf "log_c000_ph%03d.log" ${PHASE}) # Log file
SIMNAME=$(printf "AbacusSummit_small_c000_ph%03d" ${PHASE}) # Simulation name

PATH2LOG=${LOG_PATH}${LOG}

# Just to check, not necessary
echo "Launching ${SIMNAME} with config file ${PATH2CONFIG} and log file ${PATH2LOG}"

python /global/homes/s/sbouchar/ACM_pipeline/prepare_simulations/prepare_sim_logged_bgs.py --path2config $PATH2CONFIG --path2log $PATH2LOG --alt_simname $SIMNAME --overwrite 0

# Launch with : sbatch --array=11-1642 /global/homes/s/sbouchar/ACM_pipeline/prepare_simulations/small_boxes/prepare_small_logged_bgs.sh